# CLAUDE.md Deployment Strategy

## Overview

BOS-AI now implements a dual CLAUDE.md strategy with proper protection for user customizations, following AGENT-11 best practices.

## File Structure

### Development Repository (BOS-AI)

```
BOS-AI/
â”œâ”€â”€ CLAUDE.md                    # BOS-AI Business version (deployed to users)
â”‚                               # Title: "ðŸš€ BOS-AI - Your AI-Powered Business Operating System"
â””â”€â”€ .claude/CLAUDE.md           # AGENT-11 Development version (for this repo only)
                                # Title: "ðŸ”§ BOS-AI Development Environment (AGENT-11)"
```

### User Business Projects (After Deployment)

```
user-business/
â”œâ”€â”€ CLAUDE.md                    # Project-specific instructions (user customizable)
â”‚                               # Created on first deployment only
â”‚                               # Protected - never overwritten
â””â”€â”€ .claude/
    â””â”€â”€ CLAUDE.md               # BOS-AI system documentation (from BOS-AI/CLAUDE.md)
                                # Backed up before updates
                                # Title: "ðŸš€ BOS-AI - Your AI-Powered Business Operating System"
```

## Deployment Behavior

### `.claude/CLAUDE.md` (BOS-AI System Documentation)

**Source:** Root `CLAUDE.md` from BOS-AI repository

**Deployment Rules:**
1. **Always deploys** from BOS-AI/CLAUDE.md to user's .claude/CLAUDE.md
2. **Backs up existing file** if one exists before overwriting
3. **Backup naming:** `.claude/CLAUDE.md.backup.YYYYMMDD_HHMMSS`
4. **Purpose:** Ensures users have latest BOS-AI documentation and commands

**When to Use:**
- Initial deployment
- Updates to BOS-AI system
- New features or commands added
- Documentation improvements

**Verification:**
```bash
head -3 .claude/CLAUDE.md
# Should output:
# ðŸš€ BOS-AI - Your AI-Powered Business Operating System
```

### Root `CLAUDE.md` (Project-Specific Instructions)

**Source:** Generated by deployment script (not from repository)

**Deployment Rules:**
1. **Only created if doesn't exist** (first-time deployment)
2. **Never overwritten** on subsequent deployments
3. **User owns this file** - safe to customize
4. **Purpose:** Project-specific instructions that reference BOS-AI docs

**Default Content:**
```markdown
# Project with BOS-AI

This project uses BOS-AI for business operations management.

## Quick Start
- Use `/coord` for business orchestration
- Templates in `.claude/document-library/`
- Save documents to `documents/foundation/`

See `.claude/CLAUDE.md` for full BOS-AI documentation.
```

**User Customization Examples:**
```markdown
# My E-commerce Business

Using BOS-AI for business operations.

## Business Context
- Industry: E-commerce (sustainable fashion)
- Stage: Series A startup
- Team: 12 people

## Current Focus
- Q1 2025: Launch new product line
- Marketing automation setup
- Customer retention optimization

See `.claude/CLAUDE.md` for BOS-AI commands and documentation.
```

**Verification:**
```bash
# Check if file exists and is preserved
head -5 CLAUDE.md
```

## Protection Mechanisms

### 1. Backup Before Overwrite

**What:** Any existing `.claude/CLAUDE.md` is backed up before deployment

**Implementation:**
```bash
if [ -f ".claude/CLAUDE.md" ]; then
    BACKUP_FILE=".claude/CLAUDE.md.backup.$(date +%Y%m%d_%H%M%S)"
    cp .claude/CLAUDE.md "$BACKUP_FILE"
    echo "Backed up to: $BACKUP_FILE"
fi
```

**User Benefit:**
- No customizations lost
- Can review changes
- Can restore if needed

### 2. Never Overwrite Root CLAUDE.md

**What:** Root CLAUDE.md created once, then left alone

**Implementation:**
```bash
if [ ! -f "CLAUDE.md" ]; then
    # Create default project CLAUDE.md
    cat > CLAUDE.md << 'EOF'
    # Project with BOS-AI
    ...
    EOF
else
    echo "Project CLAUDE.md exists - preserving user customizations"
fi
```

**User Benefit:**
- Safe to customize project instructions
- Project-specific context preserved across updates
- No fear of losing custom documentation

## Updated Scripts

### 1. deploy-bos-ai.sh
- **Location:** `/deployment/scripts/deploy-bos-ai.sh`
- **Changes:** Added backup logic and root CLAUDE.md protection
- **Lines:** 45-89

### 2. install.sh
- **Location:** `/deployment/scripts/install.sh`
- **Changes:** Added backup logic for .claude/CLAUDE.md
- **Lines:** 77-92

### 3. install-to-project.sh
- **Location:** `/install-to-project.sh`
- **Changes:** Added backup logic for .claude/CLAUDE.md
- **Lines:** 56-70

## Migration Guide

### For Existing Deployments

If you've already deployed BOS-AI and want to update:

```bash
# In your business project
cd ~/my-business

# Check current CLAUDE.md versions
echo "=== .claude/CLAUDE.md ==="
head -3 .claude/CLAUDE.md

echo "=== Root CLAUDE.md ==="
head -3 CLAUDE.md 2>/dev/null || echo "Does not exist"

# If .claude/CLAUDE.md shows AGENT-11 development version:
# 1. Backup current file (if it has useful customizations)
cp .claude/CLAUDE.md .claude/CLAUDE.md.old

# 2. Re-run deployment
curl -fsSL https://raw.githubusercontent.com/TheWayWithin/BOS-AI/main/deployment/scripts/install.sh | bash -s full

# 3. Verify correct version deployed
head -3 .claude/CLAUDE.md
# Should show: # ðŸš€ BOS-AI - Your AI-Powered Business Operating System
```

### For New Deployments

Everything is automatic:

```bash
# In new business project
cd ~/new-business

# Run installation
curl -fsSL https://raw.githubusercontent.com/TheWayWithin/BOS-AI/main/deployment/scripts/install.sh | bash -s full

# Both CLAUDE.md files created correctly:
# - .claude/CLAUDE.md (BOS-AI system docs)
# - CLAUDE.md (project instructions)
```

## Best Practices

### For BOS-AI Developers

1. **Never edit `.claude/CLAUDE.md` directly** in user projects
2. **Always edit root `CLAUDE.md`** in BOS-AI repo for updates
3. **Test deployments** in separate business projects
4. **Verify both files** after deployment changes

### For BOS-AI Users

1. **Customize root `CLAUDE.md`** for project-specific needs
2. **Reference `.claude/CLAUDE.md`** for BOS-AI documentation
3. **Don't edit `.claude/CLAUDE.md`** (will be overwritten on updates)
4. **Check backup files** if deployment updates .claude/CLAUDE.md

## Verification Commands

```bash
# Quick verification script
echo "=== Verifying CLAUDE.md Deployment ==="
echo ""
echo "1. .claude/CLAUDE.md (BOS-AI System Docs):"
head -1 .claude/CLAUDE.md
echo ""
echo "2. Root CLAUDE.md (Project Instructions):"
if [ -f "CLAUDE.md" ]; then
    head -1 CLAUDE.md
else
    echo "   Not created yet (will be created on first deployment)"
fi
echo ""
echo "3. Backup files:"
ls -1 .claude/CLAUDE.md.backup.* 2>/dev/null || echo "   None found"
```

## Troubleshooting

### Wrong CLAUDE.md Version Deployed

**Symptom:** `.claude/CLAUDE.md` shows "AGENT-11 Development Environment"

**Fix:**
```bash
# Re-deploy from correct source
cd ~/my-business
curl -fsSL https://raw.githubusercontent.com/TheWayWithin/BOS-AI/main/deployment/scripts/install.sh | bash -s full
```

### Lost Customizations

**Symptom:** My custom CLAUDE.md was overwritten

**Solution:**
- Only `.claude/CLAUDE.md` can be overwritten (and creates backup)
- Root `CLAUDE.md` is never overwritten
- Check backup files: `ls .claude/CLAUDE.md.backup.*`

### Both Files Have Same Content

**Symptom:** Root CLAUDE.md and .claude/CLAUDE.md are identical

**Expected:** They should be different:
- `.claude/CLAUDE.md` = Full BOS-AI documentation (~400 lines)
- `CLAUDE.md` = Short project reference (~10 lines)

**Fix:** Re-run deployment to create correct root CLAUDE.md

## Summary

âœ… **What Changed:**
- `.claude/CLAUDE.md` now backs up before overwrite
- Root `CLAUDE.md` created once, then protected
- All three deployment scripts updated
- Documentation updated with verification steps

âœ… **User Benefits:**
- Safe to customize project instructions
- Never lose customizations
- Always get latest BOS-AI documentation
- Clear separation of concerns

âœ… **Developer Benefits:**
- Consistent deployment behavior
- Following AGENT-11 best practices
- Easy to test and verify
- Prevents accidental overwrites
